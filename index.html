<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trends that Suit You - Modern E-Commerce</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Material+Icons" rel="stylesheet" />
    <style>
        /* Reset and base */
        *, *::before, *::after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a, #3b82f6);
            color: #f1f5f9;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.5s ease;
        }
        a, button {
            font-family: inherit;
        }
        a {
            text-decoration: none; /* Remove underlines from links */
        }

        /* Notification banner */
        #notification {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
            font-weight: 600;
            font-size: 1rem;
            z-index: 1100;
            display: none;
            align-items: center;
            gap: 12px;
        }
        #notification.show {
            display: flex;
            animation: slideDown 0.4s ease forwards;
        }
        #notification button.close-btn {
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
            padding: 0;
        }
        @keyframes slideDown {
            from {opacity: 0; transform: translateX(-50%) translateY(-20px);}
            to {opacity: 1; transform: translateX(-50%) translateY(0);}
        }

        /* Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: rgba(255 255 255 / 0.15);
            backdrop-filter: saturate(180%) blur(20px);
            padding: 32px;
            border-radius: 24px;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .modal-content h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #f1f5f9;
            font-weight: 700;
        }
        .modal-content p {
            margin-bottom: 30px;
            color: #cbd5e1;
        }
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
        }
        .modal-actions button {
            min-width: 100px;
        }
        .modal-actions .btn-cancel {
            background: #ef4444;
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        }
        .modal-actions .btn-cancel:hover,
        .modal-actions .btn-cancel:focus {
            background: #dc2626;
            box-shadow: 0 12px 36px rgba(239, 68, 68, 0.5);
            outline: 3px solid #b91c1c;
        }

        /* Header */
        header {
            background: rgba(255 255 255 / 0.1);
            backdrop-filter: saturate(180%) blur(20px);
            padding: 0 24px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255 255 255 / 0.2);
        }
        .logo {
            font-weight: 800;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            user-select: none;
            outline-offset: 2px;
            outline: none;
            border-radius: 8px;
            padding: 4px 8px;
            margin: -4px -8px;
        }
        .logo:focus-visible {
            outline: 2px solid #3b82f6;
        }
        nav.desktop-nav {
            display: none;
        }
        button#menu-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
        }

        /* Mobile nav overlay */
        nav.mobile-nav-overlay {
            position: fixed;
            inset: 0;
            background: #0f172a; /* Solid background */
            backdrop-filter: none; /* Removed blur for full opacity */
            display: none;
            flex-direction: column;
            padding: 80px 24px 24px;
            gap: 32px;
            z-index: 105;
        }
        nav.mobile-nav-overlay.show {
            display: flex;
            animation: fadeIn 0.3s ease forwards;
        }
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        nav.mobile-nav-overlay button.close-nav {
            color: white;
            font-size: 2rem;
            background: none;
            border: none;
            align-self: flex-end;
            cursor: pointer;
        }

        nav.mobile-nav-overlay ul, nav.desktop-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        nav.desktop-nav ul {
            flex-direction: row;
        }
        nav li button {
            background: transparent;
            color: white;
            border: none;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 12px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        nav li button:hover, nav li button:focus-visible {
            background-color: #10b981;
            color: white;
            outline-offset: 2px;
            outline: 2px solid #059669;
        }

        /* Main container */
        main {
            flex-grow: 1;
            padding: 24px 16px;
            max-width: 1200px;
            margin: 0 auto 48px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Form section */
        .container {
            background: #0f172a; /* Solid background for login form */
            border-radius: 24px;
            padding: 32px 24px;
            max-width: 400px;
            margin: 48px auto;
            box-shadow: 0 12px 32px rgb(16 185 129 / 0.15);
            text-align: center;
            transition: box-shadow 0.3s ease;
        }
        .container:focus-within {
            box-shadow: 0 12px 32px rgb(59 130 246 / 0.5);
        }
        .container h2, .container h3 {
            margin-bottom: 24px;
            font-weight: 700;
            color: #d1d5db;
            user-select: none;
        }
        input[type="email"], input[type="number"], input[type="text"], input[type="tel"] {
            width: 100%;
            padding: 14px 16px;
            border-radius: 16px;
            border: 2px solid rgba(255 255 255 / 0.3);
            background: rgba(255 255 255 / 0.05);
            color: white;
            font-size: 1rem;
            outline-offset: 2px;
            outline: none;
            transition: border-color 0.3s ease;
            margin-bottom: 16px;
        }
        input[type="email"]:focus,
        input[type="number"]:focus,
        input[type="text"]:focus,
        input[type="tel"]:focus {
            border-color: #10b981;
            background: rgba(255 255 255 / 0.1);
        }
        .hidden {
            display: none !important;
        }
        button.primary-btn {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            border: none;
            color: white;
            font-weight: 700;
            padding: 14px 36px;
            font-size: 1rem;
            border-radius: 24px;
            cursor: pointer;
            transition: box-shadow 0.3s ease, transform 0.2s ease;
            user-select: none;
            width: 100%;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
        }
        button.primary-btn:hover,
        button.primary-btn:focus-visible {
            box-shadow: 0 12px 36px rgba(16, 185, 129, 0.5);
            transform: translateY(-2px);
            outline-offset: 3px;
            outline: 3px solid #059669;
        }

        /* Specific styles for login form elements */
        .login-buttons-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        #mobileHelp {
            color: #6ee7b7;
            margin-bottom: 12px;
            display: block;
            user-select: none;
        }

        /* Sections */
        section {
            display: none;
            animation: fadeInContent 0.4s ease forwards;
        }
        section.active {
            display: block;
        }
        @keyframes fadeInContent {
            from {opacity: 0; transform: translateY(10px);}
            to {opacity: 1; transform: translateY(0);}
        }

        /* Product grids */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
            gap: 24px;
            margin-top: 24px;
        }
        .product-card {
            background: rgba(255 255 255 / 0.08);
            border-radius: 24px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.15);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
            user-select: none;
            position: relative; /* Added for absolute positioning of wishlist button */
        }
        .product-card-header {
            cursor: pointer;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 10px;
            /* This header wraps the image and title/desc. The wishlist icon should be outside it, directly in .product-card */
        }
        .product-card:hover, .product-card:focus-within {
            box-shadow: 0 12px 36px rgba(16, 185, 129, 0.3);
            transform: translateY(-6px);
            outline-offset: 3px;
            outline: 3px solid #059669;
        }
        .product-card img {
            width: 100%;
            height: 180px;
            object-fit: contain;
            border-radius: 16px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            box-shadow: inset 0 0 20px rgb(255 255 255 / 0.1);
        }
        .product-title {
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #d1d5db;
            text-align: center;
        }
        .product-desc {
            font-size: 0.9rem;
            color: #94a3b8;
            text-align: center;
            margin-bottom: 12px;
            user-select: none;
            white-space: pre-line;
            min-height: 46px;
        }

        /* Quantity controls */
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        .quantity-controls button {
            background: rgba(255 255 255 / 0.1);
            border: 1.5px solid #16a34a;
            color: #10b981;
            font-weight: 700;
            cursor: pointer;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            font-size: 1.2rem;
            line-height: 1;
            transition: background-color 0.3s ease;
            user-select: none;
        }
        .quantity-controls button:hover, .quantity-controls button:focus-visible {
            background-color: #10b981;
            color: white;
            outline-offset: 3px;
            outline: 3px solid #059669;
        }
        .quantity-value {
            min-width: 24px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            user-select: none;
            color: #d1d5db;
        }

        /* Action buttons under product */
        .action-buttons {
            display: flex;
            width: 100%;
            justify-content: center;
            gap: 16px;
            margin-top: auto;
            flex-wrap: wrap;
        }
        .action-buttons button {
            flex-grow: 1;
            min-width: 120px;
        }
        .btn-buy-now {
            background: #3b82f6;
            color: white;
            border-radius: 24px;
            font-weight: 700;
        }
        .btn-buy-now:hover, .btn-buy-now:focus-visible {
            background: #2563eb;
            outline-offset: 3px;
            outline: 3px solid #1d4ed8;
        }
        /* Wishlist icon button style for product cards */
        .product-card .btn-wishlist { /* Target specifically within product-card */
            position: absolute;
            top: 10px; /* Adjust as needed for spacing */
            right: 10px; /* Adjust as needed for spacing */
            z-index: 10; /* Ensure it's above the image */
            background: rgba(255, 255, 255, 0.15); /* Slightly more opaque for visibility */
            border: 1.5px solid rgba(255, 255, 255, 0.4);
            color: #f1f5f9; /* Initial icon color */
            font-size: 1.2rem; /* Smaller icon size */
            width: 36px; /* Tiny square */
            height: 36px; /* Tiny square */
            border-radius: 12px; /* Slightly rounded square */
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            padding: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .product-card .btn-wishlist .material-icons {
            font-size: inherit;
            transition: color 0.3s ease;
        }
        .product-card .btn-wishlist:hover, .product-card .btn-wishlist:focus-visible {
            background-color: rgba(255, 255, 255, 0.3);
            border-color: #60a5fa;
            outline-offset: 3px;
            outline: 3px solid #3b82f6;
        }
        .product-card .btn-wishlist.liked {
            background-color: #ef4444; /* Red background */
            border-color: #dc2626; /* Darker red border */
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        .product-card .btn-wishlist.liked .material-icons {
            color: white;
        }
        .product-card .btn-wishlist.liked:hover, .product-card .btn-wishlist.liked:focus-visible {
            background-color: #dc2626;
            border-color: #b91c1c;
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.6);
            outline-color: #b91c1c;
        }


        /* Cart Section */
        #cart {
            max-width: 900px;
            margin: 0 auto;
        }
        .cart-summary {
            background: rgba(255 255 255 / 0.1);
            padding: 20px;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
            margin-top: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        .total {
            font-weight: 800;
            font-size: 1.4rem;
            color: #d1d5db;
            user-select: none;
        }
        #cart-items {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: 480px;
            overflow-y: auto;
        }
        .cart-item {
            background: rgba(255 255 255 / 0.08);
            border-radius: 24px;
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.15);
            padding: 16px 24px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }
        .cart-item p {
            margin: 0;
            font-weight: 600;
            font-size: 1rem;
            color: #d1d5db;
            user-select: none;
            flex: 1 1 280px;
        }
        .quantity-controls-cart {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .quantity-controls-cart button {
            background: rgba(255 255 255 / 0.1);
            border: 1.5px solid #16a34a;
            color: #10b981;
            font-weight: 700;
            cursor: pointer;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 1rem;
            line-height: 1;
            transition: background-color 0.3s ease;
            user-select: none;
        }
        .quantity-controls-cart button:hover, .quantity-controls-cart button:focus-visible {
            background-color: #10b981;
            color: white;
            outline-offset: 3px;
            outline: 3px solid #059669;
        }
        .quantity-value-cart {
            min-width: 24px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1rem;
            user-select: none;
            color: #d1d5db;
        }
        .btn-remove {
            background: transparent;
            border: none;
            color: #f87171;
            font-weight: 700;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: background-color 0.3s ease;
            user-select: none;
        }
        .btn-remove:hover, .btn-remove:focus-visible {
            background-color: #ef4444;
            color: white;
            outline-offset: 3px;
            outline: 3px solid #b91c1c;
        }
        .cart-summary button {
            flex-grow: 1;
            min-width: 140px;
        }

        /* Back button for category pages */
        button.back-button {
            background: transparent;
            border: none;
            color: #3b82f6;
            font-weight: 700;
            cursor: pointer;
            padding: 8px; /* Reduced padding for icon-like appearance */
            font-size: 1.5rem; /* Larger icon size */
            margin-bottom: 12px;
            user-select: none;
            transition: color 0.3s ease, background-color 0.3s ease, border-radius 0.3s ease;
            display: inline-flex; /* To center icon */
            align-items: center;
            justify-content: center;
            border-radius: 50%; /* Make it round */
            width: 48px; /* Fixed width for round button */
            height: 48px; /* Fixed height for round button */
        }
        button.back-button .material-icons {
            font-size: inherit; /* Ensure icon scales with button font-size */
        }
        button.back-button:hover, button.back-button:focus-visible {
            color: #2563eb;
            background-color: rgba(255, 255, 255, 0.1); /* Subtle background on hover */
            outline-offset: 3px;
            outline: 3px solid #1d4ed8;
        }
        /* Hide text in back button always */
        .back-button span:last-child {
            display: none;
        }


        /* Dashboard specific styles */
        .dashboard-section {
            background: rgba(255 255 255 / 0.1);
            border-radius: 24px;
            padding: 32px 24px;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.15);
        }
        .dashboard-section h3 {
            color: #10b981;
            margin-top: 0;
            margin-bottom: 16px;
            font-weight: 700;
            font-size: 1.3rem;
        }
        .dashboard-section p, .dashboard-section ul {
            color: #cbd5e1;
            line-height: 1.6;
        }
        .dashboard-section ul {
            list-style: none;
            padding: 0;
        }
        .dashboard-section ul li {
            background: rgba(255 255 255 / 0.05);
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        .dashboard-section ul li span {
            font-weight: 600;
        }
        .dashboard-section ul li span.item-details {
            flex-basis: 100%;
            font-size: 0.95rem;
            color: #94a3b8;
        }
        .dashboard-section ul li .btn-remove-wishlist {
            background: transparent;
            border: none;
            color: #f87171;
            font-weight: 700;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 12px;
            transition: background-color 0.3s ease;
            user-select: none;
        }
        .dashboard-section ul li .btn-remove-wishlist:hover, .dashboard-section ul li .btn-remove-wishlist:focus-visible {
            background-color: #ef4444;
            color: white;
            outline-offset: 3px;
            outline: 3px solid #b91c1c;
        }
        /* Style for editable profile fields */
        .profile-field-container {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
            gap: 8px;
        }
        .profile-field-container label {
            font-weight: 600;
            color: #d1d5db;
            min-width: 80px; /* Align labels */
            text-align: right;
        }
        .profile-field-container span,
        .profile-field-container input {
            flex-grow: 1;
            color: #cbd5e1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .profile-field-container input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.5);
        }
        .profile-field-container .field-value.hidden,
        .profile-field-container .field-input.hidden {
            display: none !important;
        }
        /* Buttons in profile section */
        .dashboard-profile-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        .dashboard-profile-actions button {
            min-width: 120px;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            margin-top: 32px;
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        }
        .logout-btn:hover, .logout-btn:focus-visible {
            background: #dc2626;
            box-shadow: 0 12px 36px rgba(239, 68, 68, 0.5);
            outline: 3px solid #b91c1c;
        }

        /* Profile Photo Area */
        .profile-photo-area {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #10b981); /* Gradient background */
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 24px; /* Center and space below */
            font-size: 4rem; /* Icon size */
            color: white;
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            overflow: hidden; /* Ensure image/icon stays within circle */
        }
        .profile-photo-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }


        /* Product Detail Page Styles */
        #product-detail {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255 255 255 / 0.1);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 12px 32px rgba(16, 185, 129, 0.15);
            display: flex; /* Use flex for layout */
            flex-direction: column; /* Stack elements by default */
            align-items: center;
            gap: 24px;
        }
        #product-detail .detail-img {
            width: 100%;
            max-width: 400px; /* Limit image size on larger screens */
            height: auto;
            object-fit: contain;
            border-radius: 16px;
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            box-shadow: inset 0 0 20px rgb(255 255 255 / 0.1);
        }
        #product-detail .detail-content {
            text-align: center;
            flex-grow: 1; /* Allows content to take available space */
        }
        #product-detail h2 {
            font-size: 2rem;
            margin-bottom: 12px;
            color: #d1d5db;
        }
        #product-detail p {
            font-size: 1.1rem;
            color: #cbd5e1;
            margin-bottom: 16px;
            white-space: pre-line; /* Preserve new lines in description */
        }
        #product-detail .price-info {
            font-weight: 800;
            font-size: 1.8rem;
            color: #10b981;
            margin-bottom: 24px;
        }
        #product-detail .detail-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin-top: 24px;
        }
        #product-detail .detail-actions .primary-btn {
            width: auto; /* Override full width for individual buttons */
            min-width: 150px;
        }
        #product-detail .detail-actions .btn-wishlist { /* Specific sizing for detail page wishlist button */
            width: 50px;
            height: 50px;
            font-size: 1.8rem; /* Larger icon */
            /* Keep original .btn-wishlist styles as base, then override */
            background: rgba(255, 255, 255, 0.1); /* Slightly less opaque for main detail */
            border: 1.5px solid #94a3b8; /* Light gray border */
            color: #94a3b8; /* Light gray icon */
            border-radius: 50%; /* Fully round */
            box-shadow: none; /* No extra shadow here by default */
        }
        #product-detail .detail-actions .btn-wishlist:hover,
        #product-detail .detail-actions .btn-wishlist:focus-visible {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: #60a5fa;
            outline-color: #3b82f6;
            box-shadow: none; /* No shadow here */
        }
        #product-detail .detail-actions .btn-wishlist.liked {
            background-color: #ef4444; /* Red background */
            border-color: #ef4444; /* Red border */
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3); /* Add shadow back for liked state */
        }
        #product-detail .detail-actions .btn-wishlist.liked:hover,
        #product-detail .detail-actions .btn-wishlist.liked:focus-visible {
            background-color: #dc2626;
            border-color: #b91c1c;
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.5);
        }

        /* Responsive adjustments for product detail */
        @media (min-width: 768px) {
            #product-detail {
                flex-direction: row;
                text-align: left;
                align-items: flex-start;
            }
            #product-detail .detail-img {
                min-width: 300px;
                max-width: 350px;
            }
            #product-detail .detail-content {
                text-align: left;
            }
            #product-detail .detail-actions {
                justify-content: flex-start;
            }
        }


        /* Responsive Layouts */
        @media(min-width: 768px) {
            nav.desktop-nav {
                display: flex;
                gap: 24px;
            }
            nav.mobile-nav-overlay {
                display: none !important;
            }
            button#menu-toggle {
                display: none;
            }
            nav li button {
                font-size: 1rem;
                padding: 6px 16px;
            }
            #notification {
                font-size: 1.1rem;
            }
            /* Back button text remains hidden always, even on desktop */
            .back-button span:last-child {
                display: none;
            }
        }
        /* Ultra wide limit for main content */
        @media (min-width: 1920px) {
            main {
                max-width: 1400px;
            }
        }

        /* Scrollbar styling for cart-items */
        #cart-items::-webkit-scrollbar, .dashboard-section ul::-webkit-scrollbar {
            width: 10px;
        }
        #cart-items::-webkit-scrollbar-track, .dashboard-section ul::-webkit-scrollbar-track {
            background: rgba(255 255 255 / 0.05);
            border-radius: 10px;
        }
        #cart-items::-webkit-scrollbar-thumb, .dashboard-section ul::-webkit-scrollbar-thumb {
            background: #10b981;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <header role="banner" aria-label="Main Header">
        <a href="#" class="logo" aria-label="Go to home page">Trends that Suit You</a>
        <button id="menu-toggle" aria-label="Open navigation menu" aria-haspopup="true" aria-expanded="false">
            <span class="material-icons" aria-hidden="true">menu</span>
        </button>
        <nav class="desktop-nav" role="navigation" aria-label="Primary navigation">
            <ul>
                <li><button type="button" data-section="dresses">Dresses</button></li>
                <li><button type="button" data-section="shoes">Shoes</button></li>
                <li><button type="button" data-section="accessories">Accessories</button></li>
                <li><button type="button" id="desktop-dashboard-btn" aria-label="View user dashboard">
                    <span class="material-icons" aria-hidden="true">person</span> Dashboard
                </button></li>
                <li><button type="button" id="desktop-cart-btn" aria-label="View shopping cart">
                    <span class="material-icons" aria-hidden="true">shopping_cart</span> Cart (<span id="cart-count-desktop">0</span>)
                </button></li>
            </ul>
        </nav>

        <nav class="mobile-nav-overlay" role="navigation" aria-label="Mobile navigation" aria-hidden="true">
            <button class="close-nav" aria-label="Close navigation menu"><span class="material-icons" aria-hidden="true">close</span></button>
            <ul>
                <li><button type="button" data-section="dresses">Dresses</button></li>
                <li><button type="button" data-section="shoes">Shoes</button></li>
                <li><button type="button" data-section="accessories">Accessories</button></li>
                <li><button type="button" id="mobile-dashboard-btn" aria-label="View user dashboard">
                    <span class="material-icons" aria-hidden="true">person</span> Dashboard
                </button></li>
                <li><button type="button" id="mobile-cart-btn" aria-label="View shopping cart">
                    <span class="material-icons" aria-hidden="true">shopping_cart</span> Cart (<span id="cart-count-mobile">0</span>)
                </button></li>
            </ul>
        </nav>
    </header>

    <div id="notification" role="alert" aria-live="assertive" aria-atomic="true">
        <span id="notification-message"></span>
        <button class="close-btn" aria-label="Dismiss notification">&times;</button>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirmationModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="modal-content">
            <h3 id="modal-title">Confirm Action</h3>
            <p id="modal-message">Are you sure?</p>
            <div class="modal-actions">
                <button id="confirmYes" class="primary-btn">Yes</button>
                <button id="confirmNo" class="primary-btn btn-cancel">No</button>
            </div>
        </div>
    </div>

    <main>
        <section id="home" class="container active" role="region" aria-label="Login form complete your details">
            <h2>Email or Phone Number</h2>
            <div class="login-buttons-container">
                <button class="primary-btn" type="button" id="btn-phone">Phone Number</button>
                <button class="primary-btn" type="button" id="btn-email">Email Address</button>
            </div>

            <form id="phoneSection" class="hidden" aria-hidden="true" aria-label="Phone number login form" novalidate>
                <h3>Enter Mobile Number</h3>
                <input type="tel" id="mobile" name="mobile" pattern="^[0-9]{10}$" placeholder="10-digit Mobile Number" autocomplete="tel" aria-required="true" aria-describedby="mobileHelp" />
                <small id="mobileHelp">Format: 10 digits only</small>
                <button class="primary-btn" type="submit" id="sendOtpPhone">Send OTP</button>
            </form>

            <form id="emailSection" class="hidden" aria-hidden="true" aria-label="Email login form" novalidate>
                <h3>Enter Email Address</h3>
                <input type="email" id="email" name="email" placeholder="Email Address" aria-required="true" autocomplete="email" />
                <button class="primary-btn" type="submit" id="sendOtpEmail">Send OTP</button>
            </form>

            <form id="otpSection" class="hidden" aria-hidden="true" aria-label="OTP verification form" novalidate>
                <h3>Enter OTP</h3>
                <input type="text" id="otp" name="otp" placeholder="Enter OTP" aria-required="true" autocomplete="one-time-code" inputmode="numeric" pattern="\d{4,6}" />
                <button class="primary-btn" type="submit" id="verifyOtpBtn">Verify OTP</button>
            </form>

            <div id="nextSection" class="hidden" aria-hidden="true" role="region" aria-live="polite">
                <h3>Next Step</h3>
                <button class="primary-btn" id="loginBtn" aria-label="Login and enter the store">Login</button>
            </div>
        </section>

        <section id="dresses" role="region" aria-label="Dresses category" tabindex="-1" hidden>
            <button class="back-button" type="button" aria-label="Back to categories">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Categories</span>
            </button>
            <h2>Dresses</h2>
            <div class="product-grid" aria-live="polite" aria-relevant="additions removals">
                <!-- Dress products added dynamically -->
            </div>
        </section>

        <section id="shoes" role="region" aria-label="Shoes category" tabindex="-1" hidden>
            <button class="back-button" type="button" aria-label="Back to categories">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Categories</span>
            </button>
            <h2>Shoes</h2>
            <div class="product-grid" aria-live="polite" aria-relevant="additions removals">
                <!-- Shoe products added dynamically -->
            </div>
        </section>

        <section id="accessories" role="region" aria-label="Accessories category" tabindex="-1" hidden>
            <button class="back-button" type="button" aria-label="Back to categories">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Categories</span>
            </button>
            <h2>Accessories</h2>
            <div class="product-grid" aria-live="polite" aria-relevant="additions removals">
                <!-- Accessories products added dynamically -->
            </div>
        </section>

        <section id="cart" role="region" aria-label="Shopping cart" tabindex="-1" hidden>
            <button class="back-button" type="button" aria-label="Back to shopping">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Shopping</span>
            </button>
            <h2>Your Shopping Cart</h2>
            <div id="cart-items" aria-live="polite" aria-relevant="additions removals"></div>
            <div class="cart-summary">
                <div class="total" id="total-price" aria-live="polite">Total Price: â‚¹0</div>
                <div class="total" id="total-items" aria-live="polite">Total Items: 0</div>
                <button class="primary-btn" id="checkoutBtn">Proceed to Checkout</button>
                <button class="primary-btn" id="clearCartBtn">Clear Cart</button>
            </div>
        </section>

        <section id="dashboard" role="region" aria-label="User Dashboard" tabindex="-1" hidden>
            <button class="back-button" type="button" aria-label="Back to shopping">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Shopping</span>
            </button>
            <h2>User Dashboard</h2>

            <div class="profile-photo-area" role="img" aria-label="User profile picture">
                <span class="material-icons">account_circle</span>
                <!-- You can replace the span with an <img> tag for a real photo -->
                <!-- <img src="https://placehold.co/120x120/3b82f6/ffffff?text=User" alt="User Profile Photo"> -->
            </div>

            <div class="dashboard-section">
                <h3>User Details</h3>
                <div class="profile-field-container">
                    <label for="edit-name">Name:</label>
                    <span id="dashboard-name" class="field-value"></span>
                    <input type="text" id="edit-name" class="field-input hidden" aria-label="Edit Name" />
                </div>
                <div class="profile-field-container">
                    <label for="edit-email">Email:</label>
                    <span id="dashboard-email" class="field-value"></span>
                    <input type="email" id="edit-email" class="field-input hidden" aria-label="Edit Email" />
                </div>
                <div class="profile-field-container">
                    <label for="edit-address">Address:</label>
                    <span id="dashboard-address" class="field-value"></span>
                    <input type="text" id="edit-address" class="field-input hidden" aria-label="Edit Address" />
                </div>
                <div class="dashboard-profile-actions">
                    <button class="primary-btn" id="editProfileBtn">Edit Profile</button>
                    <button class="primary-btn btn-cancel hidden" id="cancelEditBtn">Cancel</button>
                </div>
            </div>

            <div class="dashboard-section">
                <h3>Order History</h3>
                <ul id="order-history-list">
                    <!-- Orders will be loaded here -->
                </ul>
            </div>

            <div class="dashboard-section">
                <h3>Wishlist</h3>
                <ul id="wishlist-list">
                    <!-- Wishlist items will be loaded here -->
                </ul>
            </div>

            <button class="primary-btn logout-btn" id="logoutBtn">Logout</button>
        </section>

        <section id="product-detail" role="region" aria-label="Product Details" tabindex="-1" hidden>
            <button class="back-button" type="button" id="backToProductsBtn" aria-label="Back to products">
                <span class="material-icons" aria-hidden="true">arrow_back</span><span>Back to Products</span>
            </button>
            <img class="detail-img" id="detail-product-img" src="" alt="Product image" />
            <div class="detail-content">
                <h2 id="detail-product-title"></h2>
                <p id="detail-product-color"></p>
                <p id="detail-product-description"></p>
                <div class="price-info" id="detail-product-price"></div>

                <div class="quantity-controls">
                    <button type="button" id="detail-btn-decrease" aria-label="Decrease quantity">-</button>
                    <span class="quantity-value" id="detail-quantity-value">1</span>
                    <button type="button" id="detail-btn-increase" aria-label="Increase quantity">+</button>
                </div>

                <div class="detail-actions">
                    <button class="primary-btn" id="detail-add-to-cart-btn">Add to Cart</button>
                    <button class="primary-btn btn-buy-now" id="detail-buy-now-btn">Buy Now</button>
                    <button class="btn-wishlist" id="detail-add-to-wishlist-btn" aria-label="Add to wishlist">
                        <span class="material-icons" aria-hidden="true">favorite_border</span>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <script>
        (() => {
            "use strict";

            // Data for products with alt text and detailed description
            const productData = {
                accessories: [
                    { name: "Hat", color: "White", price: 1700, alt: "White hat on display", description: "A stylish white hat, perfect for sunny days or adding a chic touch to any outfit. Made from breathable cotton blend for comfort." },
                    { name: "Bracelet", color: "Black", price: 199, alt: "Black bracelet on display", description: "Minimalist black beaded bracelet, ideal for daily wear. Made with durable elastic string and polished onyx beads." },
                    { name: "Belt", color: "Brown", price: 159, alt: "Brown belt on display", description: "Classic brown leather belt with a sleek silver buckle. A versatile accessory for both casual and formal attire." },
                    { name: "Gold Plated Chain", color: "Gold", price: 350, alt: "Gold plated chain necklace", description: "Elegant gold-plated chain necklace, perfect for layering or wearing solo. Hypoallergenic material ensures comfortable wear." },
                    { name: "Coolers", color: "Gold and Black", price: 580, alt: "Gold and black coolers", description: "Trendy gold and black sunglasses offering UV400 protection. Lightweight frame designed for maximum comfort and style." },
                    { name: "Ring", color: "Black", price: 100, alt: "Black ring", description: "Modern black stainless steel ring, an understated accessory that adds an edgy touch to your look. Durable and scratch-resistant." },
                    { name: "Wallet", color: "Blue", price: 800, alt: "Blue wallet", description: "Compact blue bi-fold wallet made from premium synthetic leather. Features multiple card slots, a coin pouch, and a bill compartment." },
                    { name: "Watch", color: "White", price: 600, alt: "White wrist watch", description: "Sleek white minimalist wristwatch with a comfortable silicone strap. Water-resistant and perfect for everyday elegance." }
                ],
                dresses: [
                    { name: "Denim Shirt", color: "Black", price: 700, alt: "Black denim shirt", description: "A classic black denim shirt, perfect for a casual yet fashionable look. Made from soft, durable denim fabric." },
                    { name: "Fit Shirt", color: "Black", price: 499, alt: "Black fit shirt", description: "Tailored fit black shirt, designed to flatter your physique. Crafted from a comfortable stretch fabric, ideal for formal and casual occasions." },
                    { name: "Baggy T-Shirt", color: "Printed", price: 399, alt: "Printed baggy t-shirt", description: "Comfortable oversized t-shirt with a unique graphic print. Made from soft, breathable cotton, perfect for a relaxed street-style vibe." },
                    { name: "Cotton Shirt", color: "Pale Blue", price: 800, alt: "Pale blue cotton shirt", description: "Lightweight pale blue cotton shirt, perfect for warm weather. Its breathable fabric ensures comfort all day long." },
                    { name: "Party Wear", color: "Green", price: 580, alt: "Green party wear shirt", description: "Vibrant green party wear shirt with subtle sheen. Designed for a striking presence at any celebration or evening event." },
                    { name: "Goa Shirt", color: "White and Orange", price: 700, alt: "White and orange Goa shirt", description: "Relaxed fit white and orange patterned Goa shirt. Lightweight and airy, perfect for beach days or tropical getaways." },
                    { name: "Cotton Halfhand", color: "Sky Blue", price: 700, alt: "Sky blue cotton halfhand", description: "Comfortable sky blue cotton half-sleeve shirt. A wardrobe staple for casual outings, offering both style and ease." },
                    { name: "Double Packetshirt", color: "Brown", price: 600, alt: "Brown double packet shirt", description: "Rugged brown double-pocket shirt, combining utility with a trendy aesthetic. Made from sturdy cotton blend, ideal for outdoor adventures." }
                ],
                shoes: [
                    { name: "Lofers", color: "Brown", price: 300, alt: "Brown loafers", description: "Comfortable brown loafers for a sophisticated casual look. Made with a soft lining and durable sole for all-day wear." },
                    { name: "Casual Shoes", color: "Black", price: 499, alt: "Black casual shoes", description: "Versatile black casual shoes, perfect for everyday wear. Lightweight design with a cushioned sole for ultimate comfort." },
                    { name: "Sports Shoes (White)", color: "White", price: 999, alt: "White sports shoes", description: "High-performance white sports shoes designed for optimal comfort and support during physical activities. Features breathable mesh and responsive cushioning." },
                    { name: "Sports Shoes (White/Red)", color: "White and Red", price: 999, alt: "White and red sports shoes", description: "Dynamic white and red sports shoes for an energetic look. Engineered for agility and comfort, suitable for various sports." },
                    { name: "Formal Shoes", color: "Brown & Black", price: 600, alt: "Brown and black formal shoes", description: "Elegant brown and black formal shoes, perfect for business or special occasions. Crafted with a polished finish for a distinguished appearance." },
                    { name: "Spike Shoes", color: "White and Orange", price: 900, alt: "White and orange spike shoes", description: "Aggressive white and orange spike shoes, designed for enhanced grip and performance on turf. Ideal for various outdoor sports." },
                    { name: "Boots", color: "Black", price: 500, alt: "Black boots", description: "Durable black boots, offering both style and protection. Features a sturdy sole and comfortable fit for all-day wear in tough conditions." },
                    { name: "Puma Casual", color: "Grey", price: 700, alt: "Grey Puma casual shoes", description: "Stylish grey Puma casual shoes, combining athletic comfort with urban fashion. Perfect for a relaxed yet trendy everyday look." }
                ]
            };

            // Simulated user data (static for this example)
            const userProfile = {
                name: "Alex Johnson",
                email: "alex.j@example.com",
                address: "456 Commerce St, Retail Town, Fashville - 67890",
                orderHistory: [
                    { id: "ORD001", date: "2024-05-10", total: 1200, items: ["Denim Shirt (x1)", "Hat (x1)"] },
                    { id: "ORD002", date: "2024-04-22", total: 499, items: ["Fit Shirt (x1)"] },
                    { id: "ORD003", date: "2024-03-15", total: 1700, items: ["White Hat (x1)", "Brown Loafers (x1)"] }
                ],
                wishlist: [] // Initial wishlist data
            };

            // State
            let cart = [];
            let isLoggedIn = false;
            let loginSectionIsPhone = null;

            // Cache selected elements
            const notificationEl = document.getElementById("notification");
            const notificationMessageEl = document.getElementById("notification-message");
            const notificationCloseBtn = notificationEl.querySelector(".close-btn");

            // Custom Confirmation Modal elements
            const confirmationModal = document.getElementById("confirmationModal");
            const modalTitle = document.getElementById("modal-title");
            const modalMessage = document.getElementById("modal-message");
            const confirmYesBtn = document.getElementById("confirmYes");
            const confirmNoBtn = document.getElementById("confirmNo");

            // Navigation and Login Flow Elements
            const headerMenuToggle = document.getElementById("menu-toggle");
            const mobileNav = document.querySelector("nav.mobile-nav-overlay");
            const mobileNavCloseBtn = mobileNav.querySelector("button.close-nav");
            const desktopNav = document.querySelector("nav.desktop-nav");
            const desktopCartBtn = document.getElementById("desktop-cart-btn");
            const mobileCartBtn = document.getElementById("mobile-cart-btn");
            const desktopDashboardBtn = document.getElementById("desktop-dashboard-btn");
            const mobileDashboardBtn = document.getElementById("mobile-dashboard-btn");
            const logoLink = document.querySelector(".logo");

            const btnPhone = document.getElementById("btn-phone");
            const btnEmail = document.getElementById("btn-email");
            const phoneForm = document.getElementById("phoneSection");
            const emailForm = document.getElementById("emailSection");
            const otpForm = document.getElementById("otpSection");
            const nextStepSection = document.getElementById("nextSection");
            const mobileEl = document.getElementById("mobile");
            const emailEl = document.getElementById("email");
            const otpEl = document.getElementById("otp");
            const sendOtpPhoneBtn = document.getElementById("sendOtpPhone");
            const sendOtpEmailBtn = document.getElementById("sendOtpEmail");
            const verifyOtpBtn = document.getElementById("verifyOtpBtn");
            const loginBtn = document.getElementById("loginBtn");

            const clearCartBtn = document.getElementById("clearCartBtn");
            const checkoutBtn = document.getElementById("checkoutBtn");

            // Dashboard elements
            const dashboardSection = document.getElementById("dashboard");
            const dashboardName = document.getElementById("dashboard-name");
            const dashboardEmail = document.getElementById("dashboard-email");
            const dashboardAddress = document.getElementById("dashboard-address");

            // Editable profile elements
            const editNameInput = document.getElementById("edit-name");
            const editEmailInput = document.getElementById("edit-email");
            const editAddressInput = document.getElementById("edit-address");

            const nameDisplaySpan = document.getElementById("dashboard-name");
            const emailDisplaySpan = document.getElementById("dashboard-email");
            const addressDisplaySpan = document.getElementById("dashboard-address");

            const editProfileBtn = document.getElementById("editProfileBtn");
            const cancelEditBtn = document.getElementById("cancelEditBtn");


            const orderHistoryList = document.getElementById("order-history-list");
            const wishlistList = document.getElementById("wishlist-list");
            const logoutBtn = document.getElementById("logoutBtn");

            // Product Detail elements
            const productDetailSection = document.getElementById("product-detail");
            const backToProductsBtn = document.getElementById("backToProductsBtn");
            const detailProductImg = document.getElementById("detail-product-img");
            const detailProductTitle = document.getElementById("detail-product-title");
            const detailProductColor = document.getElementById("detail-product-color");
            const detailProductDescription = document.getElementById("detail-product-description");
            const detailProductPrice = document.getElementById("detail-product-price");
            const detailQuantityValue = document.getElementById("detail-quantity-value");
            const detailBtnDecrease = document.getElementById("detail-btn-decrease");
            const detailBtnIncrease = document.getElementById("detail-btn-increase");
            const detailAddToCartBtn = document.getElementById("detail-add-to-cart-btn");
            const detailBuyNowBtn = document.getElementById("detail-buy-now-btn");
            const detailAddToWishlistBtn = document.getElementById("detail-add-to-wishlist-btn");


            // Persist all application state (cart, login, userProfile including wishlist) in localStorage
            const saveState = () => {
                localStorage.setItem("cart", JSON.stringify(cart));
                localStorage.setItem("isLoggedIn", JSON.stringify(isLoggedIn));
                localStorage.setItem("userProfile", JSON.stringify(userProfile));
            };
            const loadState = () => {
                try {
                    const storedCart = JSON.parse(localStorage.getItem("cart"));
                    if (Array.isArray(storedCart)) cart = storedCart;

                    const storedLogin = JSON.parse(localStorage.getItem("isLoggedIn"));
                    if (typeof storedLogin === "boolean") isLoggedIn = storedLogin;

                    const storedUserProfile = JSON.parse(localStorage.getItem("userProfile"));
                    if (storedUserProfile && typeof storedUserProfile === 'object') {
                        // Ensure wishlist is an array even if it was not explicitly saved as such before
                        if (!Array.isArray(storedUserProfile.wishlist)) {
                            storedUserProfile.wishlist = [];
                        }
                        // Use Object.assign to merge properties, keeping existing references where possible
                        Object.assign(userProfile, storedUserProfile);
                    }
                } catch (e) {
                    console.error("Failed to load state from localStorage:", e);
                    cart = [];
                    isLoggedIn = false;
                    userProfile.wishlist = [];
                }
            };

            // Show notification message
            function showNotification(message, duration = 4000) {
                notificationMessageEl.textContent = message;
                notificationEl.classList.add("show");
                if (showNotification.timeout) clearTimeout(showNotification.timeout);
                showNotification.timeout = setTimeout(() => {
                    notificationEl.classList.remove("show");
                }, duration);
            }
            // Close notification button
            notificationCloseBtn.addEventListener("click", () => {
                clearTimeout(showNotification.timeout);
                notificationEl.classList.remove("show");
            });

            // Function to show custom confirmation modal
            function showConfirmation(message) {
                modalTitle.textContent = "Confirm Action";
                modalMessage.textContent = message;
                confirmationModal.classList.remove("hidden");
                confirmationModal.classList.add("show");
                confirmYesBtn.focus();

                return new Promise((resolve) => {
                    const handleYes = () => {
                        confirmYesBtn.removeEventListener("click", handleYes);
                        confirmNoBtn.removeEventListener("click", handleNo);
                        confirmationModal.classList.remove("show");
                        confirmationModal.classList.add("hidden");
                        resolve(true);
                    };
                    const handleNo = () => {
                        confirmYesBtn.removeEventListener("click", handleYes);
                        confirmNoBtn.removeEventListener("click", handleNo);
                        confirmationModal.classList.remove("show");
                        confirmationModal.classList.add("hidden");
                        resolve(false);
                    };
                    confirmYesBtn.addEventListener("click", handleYes);
                    confirmNoBtn.addEventListener("click", handleNo);

                    const handleEscape = (e) => {
                        if (e.key === "Escape") {
                            confirmNoBtn.click();
                            document.removeEventListener("keydown", handleEscape);
                        }
                    };
                    document.addEventListener("keydown", handleEscape);
                });
            }

            // Utility: sanitize number input quantities to integer >= 1
            function validQuantity(qty) {
                const n = parseInt(qty, 10);
                return isNaN(n) || n <= 0 ? 1 : n;
            }

            // Generate product card DOM element
            function createProductCard(product) {
                const card = document.createElement("article");
                card.classList.add("product-card");
                card.setAttribute("tabindex", "0");
                card.setAttribute("aria-label", `${product.name}, color ${product.color}, price â‚¹${product.price}`);

                const cardHeader = document.createElement("div");
                cardHeader.classList.add("product-card-header");
                cardHeader.addEventListener("click", () => showProductDetail(product));
                cardHeader.addEventListener("keydown", (e) => {
                    if (e.key === "Enter") {
                        showProductDetail(product);
                    }
                });

                // Image
                const img = document.createElement("img");
                img.src = `https://placehold.co/300x200/10b981/ffffff?text=${encodeURIComponent(product.name)}`;
                img.alt = product.alt;
                img.loading = "lazy";
                cardHeader.appendChild(img);

                // Title
                const title = document.createElement("h3");
                title.className = "product-title";
                title.textContent = product.name;
                cardHeader.appendChild(title);

                // Description (short description on card)
                const desc = document.createElement("p");
                desc.className = "product-desc";
                desc.textContent = `Color: ${product.color}\nPrice: â‚¹${product.price}`;
                cardHeader.appendChild(desc);

                card.appendChild(cardHeader);

                // Wishlist button (moved directly into product-card for absolute positioning)
                const btnAddToWishlist = document.createElement("button");
                btnAddToWishlist.type = "button";
                btnAddToWishlist.classList.add("btn-wishlist");
                btnAddToWishlist.innerHTML = `<span class="material-icons" aria-hidden="true">favorite_border</span>`;
                btnAddToWishlist.setAttribute("aria-label", `Add ${product.name} to wishlist`);

                if (userProfile.wishlist.some(item => item.name === product.name)) {
                    btnAddToWishlist.classList.add("liked");
                    btnAddToWishlist.innerHTML = `<span class="material-icons" aria-hidden="true">favorite</span>`;
                    btnAddToWishlist.setAttribute("aria-label", `Remove ${product.name} from wishlist`);
                }
                btnAddToWishlist.addEventListener("click", (e) => {
                    e.stopPropagation(); // Prevent card click event
                    toggleWishlist(product, btnAddToWishlist);
                });
                card.appendChild(btnAddToWishlist); // Append to card, not actionButtons


                const quantityControls = document.createElement("div");
                quantityControls.className = "quantity-controls";
                quantityControls.setAttribute("aria-label", `Quantity controls for ${product.name}`);

                const btnDecrease = document.createElement("button");
                btnDecrease.type = "button";
                btnDecrease.setAttribute("aria-label", `Decrease quantity of ${product.name}`);
                btnDecrease.textContent = "-";

                const quantityValue = document.createElement("span");
                quantityValue.className = "quantity-value";
                quantityValue.textContent = "1";
                quantityValue.setAttribute("aria-live", "polite");
                quantityValue.setAttribute("aria-atomic", "true");
                quantityValue.id = `qty-${product.name.replace(/\s+/g, '-')}`;

                const btnIncrease = document.createElement("button");
                btnIncrease.type = "button";
                btnIncrease.setAttribute("aria-label", `Increase quantity of ${product.name}`);
                btnIncrease.textContent = "+";

                quantityControls.appendChild(btnDecrease);
                quantityControls.appendChild(quantityValue);
                quantityControls.appendChild(btnIncrease);

                const actionButtons = document.createElement("div");
                actionButtons.className = "action-buttons";

                const btnAddToCart = document.createElement("button");
                btnAddToCart.type = "button";
                btnAddToCart.className = "primary-btn";
                btnAddToCart.textContent = "Add to Cart";
                btnAddToCart.setAttribute("aria-label", `Add ${product.name} to cart`);

                const btnBuyNow = document.createElement("button");
                btnBuyNow.type = "button";
                btnBuyNow.className = "primary-btn btn-buy-now";
                btnBuyNow.textContent = "Buy Now";
                btnBuyNow.setAttribute("aria-label", `Buy ${product.name} now`);


                btnDecrease.addEventListener("click", (e) => {
                    e.stopPropagation();
                    let val = parseInt(quantityValue.textContent, 10);
                    if (val > 1) {
                        quantityValue.textContent = val - 1;
                    }
                });
                btnIncrease.addEventListener("click", (e) => {
                    e.stopPropagation();
                    let val = parseInt(quantityValue.textContent, 10);
                    quantityValue.textContent = val + 1;
                });
                btnAddToCart.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const qty = validQuantity(quantityValue.textContent);
                    addToCart(product.name, product.price, qty);
                });
                btnBuyNow.addEventListener("click", (e) => {
                    e.stopPropagation();
                    const qty = validQuantity(quantityValue.textContent);
                    buyNowItem(product, qty); // Call the new buyNowItem function
                });

                card.appendChild(quantityControls);
                actionButtons.appendChild(btnAddToCart);
                actionButtons.appendChild(btnBuyNow);
                // Wishlist button is now outside actionButtons for product card
                card.appendChild(actionButtons);

                return card;
            }

            // Load products into their grids
            function loadProducts() {
                for (const category in productData) {
                    const section = document.getElementById(category);
                    const grid = section.querySelector(".product-grid");
                    grid.innerHTML = "";
                    productData[category].forEach(product => {
                        grid.appendChild(createProductCard(product));
                    });
                }
            }

            // Function to display detailed product information
            function showProductDetail(product) {
                if (!isLoggedIn) {
                    showNotification("Please log in to view product details.", 3000);
                    showSection("home");
                    return;
                }

                detailProductImg.src = `https://placehold.co/400x300/3b82f6/ffffff?text=${encodeURIComponent(product.name)}`;
                detailProductImg.alt = product.alt;
                detailProductTitle.textContent = product.name;
                detailProductColor.textContent = `Color: ${product.color}`;
                detailProductDescription.textContent = product.description;
                detailProductPrice.textContent = `Price: â‚¹${product.price}`;
                detailQuantityValue.textContent = "1";

                // Set initial state for wishlist button on detail page
                if (userProfile.wishlist.some(item => item.name === product.name)) {
                    detailAddToWishlistBtn.classList.add("liked");
                    detailAddToWishlistBtn.innerHTML = `<span class="material-icons" aria-hidden="true">favorite</span>`;
                    detailAddToWishlistBtn.setAttribute("aria-label", `Remove ${product.name} from wishlist`);
                } else {
                    detailAddToWishlistBtn.classList.remove("liked");
                    detailAddToWishlistBtn.innerHTML = `<span class="material-icons" aria-hidden="true">favorite_border</span>`;
                    detailAddToWishlistBtn.setAttribute("aria-label", `Add ${product.name} to wishlist`);
                }

                // Update event listeners for product detail buttons
                detailBtnDecrease.onclick = () => {
                    let val = parseInt(detailQuantityValue.textContent, 10);
                    if (val > 1) {
                        detailQuantityValue.textContent = val - 1;
                    }
                };
                detailBtnIncrease.onclick = () => {
                    let val = parseInt(detailQuantityValue.textContent, 10);
                    detailQuantityValue.textContent = val + 1;
                };
                detailAddToCartBtn.onclick = () => {
                    const qty = validQuantity(detailQuantityValue.textContent);
                    addToCart(product.name, product.price, qty);
                };
                detailBuyNowBtn.onclick = () => {
                    const qty = validQuantity(detailQuantityValue.textContent);
                    buyNowItem(product, qty); // Call the new buyNowItem function
                };
                detailAddToWishlistBtn.onclick = () => {
                    toggleWishlist(product, detailAddToWishlistBtn);
                };

                showSection("product-detail");
            }

            // New function for direct "Buy Now" checkout
            function buyNowItem(product, quantity) {
                if (!isLoggedIn) {
                    showNotification("Please log in to purchase items.", 3000);
                    showSection("home");
                    return;
                }
                cart = []; // Clear existing cart
                cart.push({ name: product.name, price: product.price, quantity: validQuantity(quantity) });
                saveState();
                updateCartCount();
                checkout(true); // Pass true to indicate it's a "Buy Now" checkout
            }


            // Add product to cart or update quantity
            function addToCart(productName, price, quantity) {
                quantity = validQuantity(quantity);
                const existing = cart.find(item => item.name === productName);
                if (existing) {
                    existing.quantity += quantity;
                } else {
                    cart.push({ name: productName, price, quantity });
                }
                showNotification(`${productName} added to cart (x${quantity})`);
                updateCartCount();
                saveState();
            }

            // Update cart quantity display badges
            function updateCartCount() {
                const totalItems = cart.reduce((acc, item) => acc + item.quantity, 0);
                document.getElementById("cart-count-desktop").textContent = totalItems;
                document.getElementById("cart-count-mobile").textContent = totalItems;
            }

            // Show notification in UI
            function showSection(sectionId) {
                const sections = document.querySelectorAll("main > section");
                sections.forEach(s => {
                    if (s.id === sectionId) {
                        s.classList.add("active");
                        s.hidden = false;
                        s.setAttribute("aria-hidden", "false");
                        s.focus();
                    } else {
                        s.classList.remove("active");
                        s.hidden = true;
                        s.setAttribute("aria-hidden", "true");
                    }
                });

                if (sectionId === "home") {
                    headerMenuToggle.setAttribute("aria-expanded", "false");
                    hideMobileNav();
                }
            }

            // Load and render cart to DOM
            function loadCart() {
                const cartItemsContainer = document.getElementById("cart-items");
                cartItemsContainer.innerHTML = "";
                if (cart.length === 0) {
                    const emptyMsg = document.createElement("p");
                    emptyMsg.textContent = "Your cart is empty.";
                    emptyMsg.style.color = "#9ca3af";
                    emptyMsg.style.fontStyle = "italic";
                    emptyMsg.style.textAlign = "center";
                    cartItemsContainer.appendChild(emptyMsg);
                    updateTotals(0, 0);
                    return;
                }

                let totalPrice = 0;
                let totalCount = 0;

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    totalPrice += itemTotal;
                    totalCount += item.quantity;

                    const cartItem = document.createElement("div");
                    cartItem.className = "cart-item";
                    cartItem.setAttribute("tabindex", "0");
                    cartItem.setAttribute("aria-label", `${item.name} quantity ${item.quantity}, price â‚¹${item.price} each, total â‚¹${itemTotal}`);

                    const itemDesc = document.createElement("p");
                    itemDesc.textContent = `${item.name} - Price: â‚¹${item.price} x ${item.quantity} = â‚¹${itemTotal}`;
                    cartItem.appendChild(itemDesc);

                    const qtyControls = document.createElement("div");
                    qtyControls.className = "quantity-controls-cart";

                    const btnInc = document.createElement("button");
                    btnInc.type = "button";
                    btnInc.setAttribute("aria-label", `Increase quantity of ${item.name}`);
                    btnInc.textContent = "+";
                    btnInc.addEventListener("click", () => changeQuantity(item.name, 1));

                    const qtyVal = document.createElement("span");
                    qtyVal.className = "quantity-value-cart";
                    qtyVal.textContent = item.quantity;
                    qtyVal.setAttribute("aria-live", "polite");
                    qtyVal.setAttribute("aria-atomic", "true");

                    const btnDec = document.createElement("button");
                    btnDec.type = "button";
                    btnDec.setAttribute("aria-label", `Decrease quantity of ${item.name}`);
                    btnDec.textContent = "-";
                    btnDec.addEventListener("click", () => changeQuantity(item.name, -1));

                    const btnRemove = document.createElement("button");
                    btnRemove.type = "button";
                    btnRemove.className = "btn-remove";
                    btnRemove.setAttribute("aria-label", `Remove ${item.name} from cart`);
                    btnRemove.textContent = "Remove";
                    btnRemove.addEventListener("click", () => removeFromCart(item.name));

                    qtyControls.appendChild(btnInc);
                    qtyControls.appendChild(qtyVal);
                    qtyControls.appendChild(btnDec);
                    qtyControls.appendChild(btnRemove);

                    cartItem.appendChild(qtyControls);
                    cartItemsContainer.appendChild(cartItem);
                });

                updateTotals(totalPrice, totalCount);
                saveState();
            }

            // Update total price and item count display
            function updateTotals(price, count) {
                document.getElementById("total-price").textContent = `Total Price: â‚¹${price}`;
                document.getElementById("total-items").textContent = `Total Items: ${count}`;
            }

            // Change quantity of item in cart (+1 or -1)
            function changeQuantity(productName, delta) {
                const product = cart.find(item => item.name === productName);
                if (!product) return;
                product.quantity += delta;
                if (product.quantity < 1) {
                    removeFromCart(productName);
                } else {
                    showNotification(`Quantity of ${productName} updated.`);
                    saveState();
                    loadCart();
                    updateCartCount();
                }
            }

            // Remove item from cart
            function removeFromCart(productName) {
                cart = cart.filter(item => item.name !== productName);
                showNotification(`${productName} removed from cart.`);
                saveState();
                loadCart();
                updateCartCount();
            }

            // Clear full cart using custom confirmation modal
            async function clearCart() {
                const confirmed = await showConfirmation("Are you sure you want to clear your entire cart?");
                if (confirmed) {
                    cart = [];
                    saveState();
                    loadCart();
                    updateCartCount();
                    showNotification("Cart cleared.");
                }
            }

            // Checkout placeholder using custom confirmation modal
            async function checkout(isBuyNow = false) {
                if (cart.length === 0) {
                    showNotification("Your cart is empty. Add items before checkout.");
                    return;
                }
                const confirmationMessage = isBuyNow ? "Proceed with instant purchase?" : "Proceed to checkout with current items?";
                const confirmed = await showConfirmation(confirmationMessage);
                if (confirmed) {
                    const purchasedItems = cart.map(item => `${item.name} (x${item.quantity})`).join(', ');
                    showNotification(`Purchase successful! Items: ${purchasedItems}.`);
                    // Clear cart after checkout
                    cart = [];
                    saveState();
                    updateCartCount();
                    showSection(isLoggedIn ? "dresses" : "home"); // Redirect to product listing after purchase
                }
            }

            // Show or hide mobile nav overlay
            function showMobileNav() {
                mobileNav.classList.add("show");
                mobileNav.setAttribute("aria-hidden", "false");
                headerMenuToggle.setAttribute("aria-expanded", "true");
                mobileNavCloseBtn.focus();
            }
            function hideMobileNav() {
                mobileNav.classList.remove("show");
                mobileNav.setAttribute("aria-hidden", "true");
                headerMenuToggle.setAttribute("aria-expanded", "false");
                headerMenuToggle.focus();
            }

            // Handle login flow UI showing/hiding with validation
            function resetLoginForms() {
                phoneForm.classList.add("hidden");
                phoneForm.setAttribute("aria-hidden", "true");
                emailForm.classList.add("hidden");
                emailForm.setAttribute("aria-hidden", "true");
                otpForm.classList.add("hidden");
                otpForm.setAttribute("aria-hidden", "true");
                nextStepSection.classList.add("hidden");
                nextStepSection.setAttribute("aria-hidden", "true");
                loginSectionIsPhone = null;
                clearOtpTimeout();
            }

            // Show phone or email input form and reset states
            function showPhoneInput() {
                resetLoginForms();
                phoneForm.classList.remove("hidden");
                phoneForm.setAttribute("aria-hidden", "false");
                mobileEl.focus();
                loginSectionIsPhone = true;
            }
            function showEmailInput() {
                resetLoginForms();
                emailForm.classList.remove("hidden");
                emailForm.setAttribute("aria-hidden", "false");
                emailEl.focus();
                loginSectionIsPhone = false;
            }

            // Manage OTP sending and verification logic
            let otpSentTimeoutId = null;
            function clearOtpTimeout() {
                if (otpSentTimeoutId) {
                    clearTimeout(otpSentTimeoutId);
                    otpSentTimeoutId = null;
                }
            }
            function simulateSendOtp(input) {
                showNotification(`OTP sent to ${input}`);
                clearOtpTimeout();
                otpSentTimeoutId = setTimeout(() => {
                    showNotification("OTP expired. Please request again.");
                    resetLoginForms();
                }, 3 * 60 * 1000);
            }

            function sendOtpHandler(e) {
                e.preventDefault();
                if (loginSectionIsPhone) {
                    const val = mobileEl.value.trim();
                    if (!/^[0-9]{10}$/.test(val)) {
                        showNotification("Please enter a valid 10-digit mobile number.", 3000);
                        mobileEl.focus();
                        return;
                    }
                    simulateSendOtp(val);
                } else {
                    const val = emailEl.value.trim();
                    const mailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!mailRegex.test(val)) {
                        showNotification("Please enter a valid email address.", 3000);
                        emailEl.focus();
                        return;
                    }
                    simulateSendOtp(val);
                }
                otpForm.classList.remove("hidden");
                otpForm.setAttribute("aria-hidden", "false");
                otpEl.focus();
                disableSendButtons(true);
                setTimeout(() => disableSendButtons(false), 30000);
            }

            function disableSendButtons(disable) {
                sendOtpPhoneBtn.disabled = disable;
                sendOtpEmailBtn.disabled = disable;
            }

            function verifyOtpHandler(e) {
                e.preventDefault();
                const val = otpEl.value.trim();
                if (!/^\d{4,6}$/.test(val)) {
                    showNotification("Please enter a valid OTP (4-6 digits).", 3000);
                    otpEl.focus();
                    return;
                }
                clearOtpTimeout();
                showNotification("OTP verified successfully!");
                otpForm.classList.add("hidden");
                otpForm.setAttribute("aria-hidden", "true");
                nextStepSection.classList.remove("hidden");
                nextStepSection.setAttribute("aria-hidden", "false");
                loginBtn.focus();
            }

            function loginHandler() {
                isLoggedIn = true;
                saveState();
                showNotification("Login successful! Welcome!");
                showSection("dresses");
            }

            // Function to show the Dashboard section
            function showDashboard() {
                if (!isLoggedIn) {
                    showNotification("Please log in to view your dashboard.", 3000);
                    showSection("home");
                    return;
                }
                loadDashboardData();
                toggleEditMode(false); // Ensure it's in display mode when showing dashboard
                showSection("dashboard");
                if (isMobileView()) {
                    hideMobileNav();
                }
            }

            // Toggle between display and edit mode for profile fields
            function toggleEditMode(isEditing) {
                nameDisplaySpan.classList.toggle("hidden", isEditing);
                emailDisplaySpan.classList.toggle("hidden", isEditing);
                addressDisplaySpan.classList.toggle("hidden", isEditing);

                editNameInput.classList.toggle("hidden", !isEditing);
                editEmailInput.classList.toggle("hidden", !isEditing);
                editAddressInput.classList.toggle("hidden", !isEditing);

                editProfileBtn.textContent = isEditing ? "Save Changes" : "Edit Profile";
                cancelEditBtn.classList.toggle("hidden", !isEditing);

                if (isEditing) {
                    editNameInput.focus();
                }
            }

            // Load data into the dashboard section
            function loadDashboardData() {
                // Set text for display spans
                nameDisplaySpan.textContent = userProfile.name;
                emailDisplaySpan.textContent = userProfile.email;
                addressDisplaySpan.textContent = userProfile.address;

                // Set values for edit inputs
                editNameInput.value = userProfile.name;
                editEmailInput.value = userProfile.email;
                editAddressInput.value = userProfile.address;

                orderHistoryList.innerHTML = "";
                if (userProfile.orderHistory.length === 0) {
                    orderHistoryList.innerHTML = '<li>No orders found.</li>';
                } else {
                    userProfile.orderHistory.forEach(order => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                            <span>Order ID: ${order.id}</span>
                            <span>Date: ${order.date}</span>
                            <span>Total: â‚¹${order.total}</span>
                            <span class="item-details">Items: ${order.items.join(', ')}</span>
                        `;
                        orderHistoryList.appendChild(li);
                    });
                }

                wishlistList.innerHTML = "";
                if (userProfile.wishlist.length === 0) {
                    wishlistList.innerHTML = '<li>Your wishlist is empty.</li>';
                } else {
                    userProfile.wishlist.forEach(item => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                            <span>${item.name}</span>
                            <span>Price: â‚¹${item.price}</span>
                            <button class="btn-remove-wishlist" data-product-name="${item.name}" aria-label="Remove ${item.name} from wishlist">Remove</button>
                        `;
                        wishlistList.appendChild(li);
                    });
                    wishlistList.querySelectorAll(".btn-remove-wishlist").forEach(button => {
                        button.addEventListener("click", (e) => {
                            const productName = e.target.dataset.productName;
                            removeFromWishlist(productName);
                        });
                    });
                }
            }

            // Save profile changes
            function saveProfileChanges() {
                const newName = editNameInput.value.trim();
                const newEmail = editEmailInput.value.trim();
                const newAddress = editAddressInput.value.trim();

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                if (!newName || !newEmail || !newAddress) {
                    showNotification("All fields are required.", 3000);
                    return;
                }
                if (!emailRegex.test(newEmail)) {
                    showNotification("Please enter a valid email address.", 3000);
                    return;
                }

                userProfile.name = newName;
                userProfile.email = newEmail;
                userProfile.address = newAddress;
                saveState();
                showNotification("Profile updated successfully!");
                toggleEditMode(false); // Exit edit mode
                loadDashboardData(); // Reload data to show updated values
            }

            // Cancel profile edit
            function cancelProfileEdit() {
                toggleEditMode(false); // Exit edit mode
                loadDashboardData(); // Reload data to revert to previous values
                showNotification("Profile changes discarded.");
            }

            // Toggle product in/out of wishlist
            function toggleWishlist(product, buttonElement) {
                if (!isLoggedIn) {
                    showNotification("Please log in to add items to your wishlist.", 3000);
                    showSection("home");
                    return;
                }

                const existingIndex = userProfile.wishlist.findIndex(item => item.name === product.name);
                if (existingIndex > -1) {
                    userProfile.wishlist.splice(existingIndex, 1);
                    showNotification(`${product.name} removed from wishlist.`);
                    if (buttonElement) {
                        buttonElement.classList.remove("liked");
                        buttonElement.innerHTML = `<span class="material-icons" aria-hidden="true">favorite_border</span>`;
                        buttonElement.setAttribute("aria-label", `Add ${product.name} to wishlist`);
                    }
                } else {
                    userProfile.wishlist.push({ name: product.name, price: product.price });
                    showNotification(`${product.name} added to wishlist!`);
                    if (buttonElement) {
                        buttonElement.classList.add("liked");
                        buttonElement.innerHTML = `<span class="material-icons" aria-hidden="true">favorite</span>`;
                        buttonElement.setAttribute("aria-label", `Remove ${product.name} from wishlist`);
                    }
                }
                saveState();
                loadDashboardData();
                updateAllWishlistButtonsState();
            }

            // Function to update the state of all wishlist buttons on the page
            function updateAllWishlistButtonsState() {
                document.querySelectorAll('.btn-wishlist').forEach(button => {
                    // Extract product name from aria-label, which always reflects the correct name.
                    const ariaLabel = button.getAttribute('aria-label');
                    let productName;
                    if (ariaLabel.includes('Add ')) {
                        productName = ariaLabel.replace('Add ', '').replace(' to wishlist', '');
                    } else if (ariaLabel.includes('Remove ')) {
                        productName = ariaLabel.replace('Remove ', '').replace(' from wishlist', '');
                    } else {
                        console.warn('Unexpected aria-label format for wishlist button:', ariaLabel);
                        return;
                    }

                    const isInWishlist = userProfile.wishlist.some(item => item.name === productName);
                    if (isInWishlist) {
                        button.classList.add('liked');
                        button.innerHTML = `<span class="material-icons" aria-hidden="true">favorite</span>`;
                        button.setAttribute("aria-label", `Remove ${productName} from wishlist`);
                    } else {
                        button.classList.remove('liked');
                        button.innerHTML = `<span class="material-icons" aria-hidden="true">favorite_border</span>`;
                        button.setAttribute("aria-label", `Add ${productName} to wishlist`);
                    }
                });
            }


            // Remove item from wishlist (specifically from dashboard)
            function removeFromWishlist(productName) {
                const existingIndex = userProfile.wishlist.findIndex(item => item.name === productName);
                if (existingIndex > -1) {
                    userProfile.wishlist.splice(existingIndex, 1);
                    showNotification(`${productName} removed from wishlist.`);
                    saveState();
                    loadDashboardData();
                    updateAllWishlistButtonsState();
                }
            }

            // Handle user logout
            function logoutHandler() {
                isLoggedIn = false;
                saveState();
                showNotification("You have been logged out successfully.", 3000);
                showSection("home");
                resetLoginForms();
            }

            // On back buttons clicked, return to category navigation or home (or previous product listing)
            function backToCategories() {
                const currentActiveSectionId = document.querySelector('main > section.active')?.id;
                if (currentActiveSectionId === "product-detail") {
                    const lastProductCategory = localStorage.getItem('lastProductCategory') || 'dresses';
                    showSection(lastProductCategory);
                } else {
                    showSection(isLoggedIn ? "dresses" : "home");
                }
            }

            // Show cart section
            function showCart() {
                if (!isLoggedIn) {
                    showNotification("Please log in to view your cart.", 3000);
                    showSection("home");
                    return;
                }
                showSection("cart");
                loadCart();
                if (isMobileView()) {
                    hideMobileNav();
                }
            }

            // Detect mobile view
            function isMobileView() {
                return window.innerWidth < 768;
            }

            // Bind all UI events
            function bindUIEvents() {
                // Responsive nav toggles
                headerMenuToggle.addEventListener("click", () => {
                    if (mobileNav.classList.contains("show")) {
                        hideMobileNav();
                    } else {
                        showMobileNav();
                    }
                });
                mobileNavCloseBtn.addEventListener("click", () => {
                    hideMobileNav();
                    headerMenuToggle.focus();
                });

                // Logo click to go home
                logoLink.addEventListener("click", (e) => {
                    e.preventDefault();
                    if (isLoggedIn) {
                        showSection("dresses");
                    } else {
                        showSection("home");
                    }
                    hideMobileNav();
                });

                // Category buttons (desktop and mobile nav)
                document.querySelectorAll('nav li button[data-section]').forEach(button => {
                    button.addEventListener('click', (e) => {
                        if (!isLoggedIn) {
                            showNotification("Please log in to view products.", 3000);
                            showSection("home");
                            return;
                        }
                        showSection(e.target.dataset.section);
                        if (isMobileView()) {
                            hideMobileNav();
                        }
                    });
                });

                // Dashboard buttons (desktop and mobile nav)
                desktopDashboardBtn.addEventListener("click", e => {
                    e.preventDefault();
                    showDashboard();
                });
                mobileDashboardBtn.addEventListener("click", e => {
                    e.preventDefault();
                    showDashboard();
                });

                // Cart buttons
                desktopCartBtn.addEventListener("click", e => {
                    e.preventDefault();
                    showCart();
                });
                mobileCartBtn.addEventListener("click", e => {
                    e.preventDefault();
                    showCart();
                });

                // Back buttons in sections
                document.querySelectorAll("button.back-button").forEach(btn => {
                    btn.addEventListener("click", (e) => {
                        e.preventDefault();
                        backToCategories();
                    });
                });

                // Back button for product detail view specifically
                backToProductsBtn.addEventListener("click", (e) => {
                    e.preventDefault();
                    const lastProductCategory = localStorage.getItem('lastProductCategory') || 'dresses';
                    showSection(lastProductCategory);
                });


                // Clear cart
                clearCartBtn.addEventListener("click", e => {
                    e.preventDefault();
                    clearCart();
                });

                // Checkout (for the cart)
                checkoutBtn.addEventListener("click", e => {
                    e.preventDefault();
                    checkout(false); // Indicates it's a regular cart checkout
                });

                // Login buttons in login form
                btnPhone.addEventListener("click", () => {
                    showPhoneInput();
                });
                btnEmail.addEventListener("click", () => {
                    showEmailInput();
                });

                // Send OTP forms
                phoneForm.addEventListener("submit", sendOtpHandler);
                emailForm.addEventListener("submit", sendOtpHandler);

                // Verify OTP form
                otpForm.addEventListener("submit", verifyOtpHandler);

                // Login Button after OTP verification
                loginBtn.addEventListener("click", loginHandler);

                // Logout Button
                logoutBtn.addEventListener("click", logoutHandler);

                // Dashboard Edit Profile buttons
                editProfileBtn.addEventListener("click", () => {
                    if (editProfileBtn.textContent === "Edit Profile") {
                        toggleEditMode(true);
                    } else {
                        saveProfileChanges();
                    }
                });
                cancelEditBtn.addEventListener("click", cancelProfileEdit);

                // Keyboard accessibility: close mobile nav on ESC
                document.addEventListener("keydown", (e) => {
                    if (e.key === "Escape") {
                        if (mobileNav.classList.contains("show")) {
                            hideMobileNav();
                            headerMenuToggle.focus();
                        }
                    }
                });

                 // Save last visited product category
                 document.querySelectorAll('#dresses, #shoes, #accessories').forEach(section => {
                    section.addEventListener('click', (e) => {
                        if (e.target.tagName === 'BUTTON' || e.target.closest('.product-card-header')) {
                             // Do nothing if click originated from product card header or button inside product card
                        } else {
                            localStorage.setItem('lastProductCategory', section.id);
                        }
                    }, true);
                 });
            }

            // Entry point on page load
            function init() {
                loadState();
                loadProducts();
                updateCartCount();
                bindUIEvents();

                // Initial view: Ensure 'home' section is shown and all other sections are hidden.
                // This correctly ensures product sections are not visible on the login page.
                if (isLoggedIn) {
                    const lastProductCategory = localStorage.getItem('lastProductCategory') || 'dresses';
                    showSection(lastProductCategory);
                } else {
                    showSection("home"); 
                    resetLoginForms();
                }
            }

            // Initialize app
            init();

            // Expose showSection globally
            window.showSection = function(id) {
                showSection(id);
                if (id === "home") {
                    resetLoginForms();
                }
            };
        })();
    </script>
</body>
</html>
